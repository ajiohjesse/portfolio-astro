---
import { getCollection } from 'astro:content';
import SectionHeader from './SectionHeader';
import FormattedDate from './FormattedDate.astro';

const posts = (await getCollection('blog'))
  .filter(post => post.data.isPublished)
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
---

<section class="container">
  <SectionHeader number={5} heading="Latest Posts" />

  <div class="pt-12 pb-8">
    {
      posts.length > 0 ? (
        posts.map(post => (
          <a href={`/blog${post.id}`} class="block">
            <div class="bg-card p-6 rounded shadow-md mb-6 hover:shadow-xl transition group">
              <h3 class="text-xl font-bold group-hover:text-primary transition">
                {post.data.title}
              </h3>
              <p class="text-muted block text-sm mb-4 mt-2">
                <FormattedDate date={post.data.publishedAt} />
              </p>
              <p class="text-muted">{post.data.description}</p>
            </div>
          </a>
        ))
      ) : (
        <p class="text-lg text-muted text-center">No post published yet.</p>
      )
    }
  </div>

  {
    posts.length > 0 ? (
      <a
        href="/blog"
        class="py-6 px-12 rounded mt-8 block bg-primary w-max mx-auto leading-0 p-0 hover:shadow-2xl shadow-primary/30 active:scale-95 transition-all"
      >
        See all Posts
      </a>
    ) : null
  }
</section>
